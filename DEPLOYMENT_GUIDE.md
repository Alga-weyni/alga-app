# üöÄ Alga Zero-Cost Deployment Guide

## Overview
Deploy Alga to **100% free hosting** using Render (backend) and Vercel (frontend).

**Total Monthly Cost: $0.00** üí∞

---

## ‚úÖ Pre-Deployment Checklist

- [x] Production build tested (`npm run build` ‚úì)
- [x] GitHub repository configured
- [x] Database migrated to Neon (PostgreSQL)
- [x] Environment variables documented
- [x] Payment integrations ready (Chapa, Stripe, PayPal, Telebirr)

---

## üéØ Deployment Steps

### Step 1: Push Latest Code to GitHub

```bash
# Ensure you're on main branch
git checkout main

# Add all changes
git add .

# Commit with deployment message
git commit -m "Production deployment - Zero-cost infrastructure"

# Push to GitHub
git push origin main
```

**Verify**: Check [github.com/Alga-weyni/alga-app](https://github.com/Alga-weyni/alga-app) to confirm code is pushed.

---

### Step 2: Deploy Backend to Render (FREE Tier)

#### 2.1 Create Render Account
1. Go to [render.com](https://render.com)
2. Sign up with your GitHub account
3. Click "New +" ‚Üí "Web Service"

#### 2.2 Connect Repository
1. Select **"alga-app"** repository
2. Click "Connect"

#### 2.3 Configure Service
- **Name**: `alga-backend`
- **Region**: Oregon (US West)
- **Branch**: `main`
- **Runtime**: Node
- **Build Command**: `npm install && npm run build`
- **Start Command**: `npm start`
- **Plan**: **Free** (Select this!)

#### 2.4 Add Environment Variables

Click "Advanced" ‚Üí "Add Environment Variable" for each:

```bash
# Required Variables
NODE_ENV=production
DATABASE_URL=postgresql://[YOUR_NEON_CONNECTION_STRING]
SESSION_SECRET=[auto-generated-by-render]

# Payment Integrations
CHAPA_SECRET_KEY=[get-from-chapa-dashboard]
SENDGRID_API_KEY=[your-sendgrid-key]

# Optional (for additional payment methods)
STRIPE_SECRET_KEY=[your-stripe-secret]
STRIPE_PUBLIC_KEY=[your-stripe-public]
PAYPAL_CLIENT_ID=[your-paypal-client]
PAYPAL_CLIENT_SECRET=[your-paypal-secret]

# App URL (will update after deployment)
APP_URL=https://alga-backend.onrender.com
```

**Where to get keys:**
- **DATABASE_URL**: Neon Dashboard ‚Üí Connection String
- **CHAPA_SECRET_KEY**: [dashboard.chapa.co](https://dashboard.chapa.co) ‚Üí Settings ‚Üí API Keys
- **SENDGRID_API_KEY**: Already configured in Replit Secrets
- **SESSION_SECRET**: Auto-generated by Render

#### 2.5 Deploy
1. Click "Create Web Service"
2. Wait 3-5 minutes for build
3. Copy the deployed URL: `https://alga-backend.onrender.com`

**Health Check**: Visit `https://alga-backend.onrender.com/api/health` - should return `{"status":"ok"}`

---

### Step 3: Deploy Frontend to Vercel (FREE Tier)

#### 3.1 Create Vercel Account
1. Go to [vercel.com](https://vercel.com)
2. Sign up with your GitHub account
3. Click "Add New..." ‚Üí "Project"

#### 3.2 Import Repository
1. Find **"alga-app"** in the list
2. Click "Import"

#### 3.3 Configure Project
- **Framework Preset**: Other (leave as is)
- **Root Directory**: `./` (default)
- **Build Command**: `npm run build`
- **Output Directory**: `dist/public`
- **Install Command**: `npm install`

#### 3.4 Add Environment Variables

```bash
# Frontend API URL (use your Render backend URL)
VITE_API_URL=https://alga-backend.onrender.com

# Payment Keys (public only)
VITE_STRIPE_PUBLIC_KEY=[your-stripe-public-key]
VITE_CHAPA_PUBLIC_KEY=[your-chapa-public-key]
```

#### 3.5 Deploy
1. Click "Deploy"
2. Wait 2-3 minutes for build
3. Copy the deployed URL: `https://alga-app.vercel.app`

**Note**: Vercel will auto-deploy on every push to `main` branch!

---

### Step 4: Update Backend APP_URL

Go back to Render dashboard:
1. Open your `alga-backend` service
2. Go to "Environment" tab
3. Update `APP_URL` to your Vercel frontend URL:
   ```
   APP_URL=https://alga-app.vercel.app
   ```
4. Click "Save Changes"
5. Service will auto-redeploy

---

### Step 5: Seed Database with Test Data

**Option A: Via Render Dashboard**
1. Go to Render dashboard ‚Üí alga-backend
2. Click "Shell" tab
3. Run: `npm run seed`

**Option B: Via Local with Production DB**
1. Set `DATABASE_URL` locally to your Neon connection
2. Run: `npm run seed`
3. Remove local `DATABASE_URL` after seeding

**Test Data Includes:**
- Sample properties in Addis Ababa, Bahir Dar, Gondar
- Test users (guest, host, admin)
- Reviews and bookings

---

### Step 6: End-to-End Testing

Test the complete user flow on your **live site**:

#### 6.1 Sign Up & OTP
1. Visit `https://alga-app.vercel.app`
2. Click "Sign In"
3. Enter phone/email
4. Receive OTP (check email/SMS)
5. Verify OTP ‚Üí Logged in ‚úÖ

#### 6.2 Browse & Book
1. Browse properties on homepage
2. Click any property
3. Click "Book Now"
4. Select dates and guests
5. Choose payment method ‚úÖ

#### 6.3 Payment (Chapa)
1. Select "Chapa" payment
2. Confirm booking
3. Complete payment in iframe
4. Verify booking status updates to "paid" ‚úÖ

#### 6.4 Email Confirmation
1. Check email for booking confirmation
2. Verify access code received
3. Check booking details ‚úÖ

---

## üîç Verification Checklist

After deployment, verify all features work:

- [ ] Homepage loads at Vercel URL
- [ ] Sign up with OTP works
- [ ] Login with OTP works
- [ ] Browse properties
- [ ] Search & filters work
- [ ] Property details load
- [ ] Booking creation works
- [ ] Chapa payment iframe loads
- [ ] Payment verification updates booking
- [ ] Email confirmations sent (via SendGrid)
- [ ] Access codes generated
- [ ] Host dashboard accessible
- [ ] Admin panel accessible

---

## üìä Live URLs

After deployment, you'll have:

- **Frontend (Vercel)**: `https://alga-app.vercel.app`
- **Backend (Render)**: `https://alga-backend.onrender.com`
- **Database (Neon)**: Already configured
- **Email (SendGrid)**: Already configured

---

## üí∞ Free Tier Limits

### Render Free Tier
- ‚úÖ 750 hours/month (enough for 1 service 24/7)
- ‚úÖ Auto-sleep after 15 min inactivity (wakes on request)
- ‚úÖ 512 MB RAM
- ‚úÖ Shared CPU
- ‚ö†Ô∏è Cold starts (30s delay on first request after sleep)

### Vercel Free Tier
- ‚úÖ 100 GB bandwidth/month
- ‚úÖ Unlimited deployments
- ‚úÖ Instant deployments on push
- ‚úÖ Edge network (fast globally)
- ‚úÖ Automatic SSL

### Neon Free Tier
- ‚úÖ 512 MB storage
- ‚úÖ 1 project
- ‚úÖ Auto-suspend after 5 min inactivity
- ‚úÖ PostgreSQL with Drizzle ORM

---

## üõ°Ô∏è Security Best Practices

‚úÖ **Already Implemented:**
- HTTPS-only (automatic on Render & Vercel)
- Environment variables encrypted
- CORS configured for production
- Rate limiting enabled
- Helmet.js security headers
- Session secret auto-generated
- No secrets in code (all in env vars)

---

## üö® Troubleshooting

### Backend won't start on Render
- Check "Logs" tab in Render dashboard
- Verify all environment variables are set
- Ensure `DATABASE_URL` is correct
- Check build logs for errors

### Frontend can't reach backend
- Verify `VITE_API_URL` in Vercel env vars
- Check Render backend is running
- Test backend health: `/api/health`
- Check CORS settings in backend

### Database connection fails
- Verify Neon database is active
- Check `DATABASE_URL` format
- Ensure Neon allows external connections
- Run `npm run db:push` to sync schema

### Payments not working
- Verify payment API keys in Render env vars
- Check Chapa dashboard for transaction logs
- Test with Chapa test mode first
- Ensure webhook URLs point to Render backend

### Emails not sending
- Check SendGrid API key is valid
- Verify SendGrid domain/sender verified
- Check Render logs for email errors
- Test with SendGrid dashboard

---

## üìà Post-Deployment Tasks

### 1. Custom Domain (Optional - $12/year)
- Buy domain from Namecheap/GoDaddy
- Add to Vercel: Settings ‚Üí Domains
- Update DNS records

### 2. Monitor Performance
- **Render**: Check "Metrics" tab for usage
- **Vercel**: Check Analytics dashboard
- **Neon**: Monitor connection count

### 3. Set Up Monitoring
- Add [UptimeRobot](https://uptimerobot.com) (free) to ping your site every 5 min
- This prevents cold starts and keeps backend warm

### 4. Backup Database
- Neon has automatic backups
- Export data manually: `pg_dump` command

---

## ‚úÖ Canceling Replit Subscription

**ONLY after confirming everything works on Render/Vercel:**

1. Go to [replit.com/account](https://replit.com/account)
2. Click "Subscription" tab
3. Click "Cancel Subscription"
4. Confirm cancellation
5. Download any important files first!

**‚ö†Ô∏è Important**: 
- Keep the Replit project as a backup for 1 month
- Download deployment configs and .env files
- Confirm all features work on new hosting first

---

## üéâ Success Metrics

Your deployment is successful when:

‚úÖ Frontend loads in < 3 seconds  
‚úÖ Backend responds in < 500ms (after warm-up)  
‚úÖ OTP emails delivered in < 30 seconds  
‚úÖ Payments process successfully  
‚úÖ No console errors on frontend  
‚úÖ Zero monthly hosting costs  

---

## üìû Support Resources

- **Render Docs**: [render.com/docs](https://render.com/docs)
- **Vercel Docs**: [vercel.com/docs](https://vercel.com/docs)
- **Neon Docs**: [neon.tech/docs](https://neon.tech/docs)
- **Chapa Support**: support@chapa.co

---

## üèÅ Quick Start Command

Run this after deployment to test everything:

```bash
# Test backend health
curl https://alga-backend.onrender.com/api/health

# Test frontend
curl -I https://alga-app.vercel.app

# Seed database (run once)
# Via Render Shell: npm run seed
```

---

**Deployment Date**: October 22, 2025  
**Estimated Setup Time**: 30-45 minutes  
**Monthly Cost**: $0.00  
**Status**: ‚úÖ Ready for Production
