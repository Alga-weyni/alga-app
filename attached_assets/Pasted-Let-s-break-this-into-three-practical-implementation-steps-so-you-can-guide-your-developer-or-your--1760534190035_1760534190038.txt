Let‚Äôs break this into three practical implementation steps so you can guide your developer (or your Replit agent) clearly.

‚öôÔ∏è 1. Replace Replit Auth with Custom Authentication

Replit Auth is great for testing but very limited ‚Äî it doesn‚Äôt support email/password or roles.
You need to build your own Auth logic using either:

Option A ‚Äì NextAuth.js (recommended)

If Alga is running on Next.js:

npm install next-auth


Then in /pages/api/auth/[...nextauth].js:

import NextAuth from "next-auth";
import CredentialsProvider from "next-auth/providers/credentials";
import { db } from "@/lib/db"; // your drizzle or prisma connection

export default NextAuth({
  providers: [
    CredentialsProvider({
      name: "Credentials",
      credentials: {
        emailOrPhone: { label: "Email or Phone", type: "text" },
        password: { label: "Password", type: "password" },
      },
      async authorize(credentials) {
        const user = await db.user.findFirst({
          where: {
            OR: [
              { email: credentials.emailOrPhone },
              { phone: credentials.emailOrPhone },
            ],
          },
        });
        if (!user || user.password !== credentials.password) {
          throw new Error("Invalid credentials");
        }
        return user;
      },
    }),
  ],
  callbacks: {
    async jwt({ token, user }) {
      if (user) token.role = user.role;
      return token;
    },
    async session({ session, token }) {
      session.user.role = token.role;
      return session;
    },
  },
  pages: {
    signIn: "/auth/signin",
  },
});


‚úÖ Outcome:
You‚Äôll now have a login page that asks for email/phone + password, authenticates against your DB, and stores user roles in the session.

üß© 2. Redirect Users Based on Role

Once login succeeds, redirect users dynamically based on their role.

In /pages/auth/signin.js or after your form submission:

import { signIn } from "next-auth/react";
import { useRouter } from "next/router";

const handleLogin = async (e) => {
  e.preventDefault();
  const result = await signIn("credentials", {
    redirect: false,
    emailOrPhone,
    password,
  });

  if (result.ok) {
    // Fetch session
    const res = await fetch("/api/auth/session");
    const session = await res.json();
    const role = session.user.role;

    switch (role) {
      case "admin":
        router.push("/admin/dashboard");
        break;
      case "operator":
        router.push("/operator/dashboard");
        break;
      case "guesthouse_owner":
        router.push("/owner/dashboard");
        break;
      default:
        router.push("/tenant/home");
    }
  } else {
    setError("Invalid login credentials");
  }
};


‚úÖ Outcome:
Admins ‚Üí Admin Dashboard
Operators ‚Üí Verification panel
Owners ‚Üí Manage listings
Tenants ‚Üí Browse properties

üîí 3. Role-Based Access Control (RBAC)

To protect pages based on privilege:

import { useSession } from "next-auth/react";

export default function AdminPage() {
  const { data: session, status } = useSession();

  if (status === "loading") return <p>Loading...</p>;
  if (session?.user.role !== "admin") return <p>Access denied</p>;

  return <AdminDashboard />;
}


‚úÖ Outcome:
Unauthorized users cannot visit restricted routes even if they type the URL manually.

üß± Optional (Advanced Layer)

You can create middleware in Next.js (/middleware.js) to protect routes automatically:

import { getToken } from "next-auth/jwt";

export async function middleware(req) {
  const token = await getToken({ req });
  const url = req.nextUrl.pathname;

  if (url.startsWith("/admin") && token?.role !== "admin") {
    return Response.redirect(new URL("/unauthorized", req.url));
  }
  // Add other role checks here
}

‚úÖ Summary: What You Need to Do Next
Step	Task	Description
1	Install and configure NextAuth.js	Replace Replit Auth
2	Set up email/phone + password fields	Link to PostgreSQL users table
3	Add role column (admin, operator, owner, tenant) in DB	Assign at registration
4	Redirect users post-login based on role	Dynamic routing
5	Protect dashboards via middleware	Enforce security
6	(Optional) Add ‚ÄúForgot Password‚Äù and Email Verification later	Improve UX