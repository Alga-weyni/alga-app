РюЁ REPLIT AGENT РђЊ CLOUDLARE R2 PRODUCTION SETUP (AUTHORITATIVE)
OBJECTIVE

Replace all local/Replit image storage with Cloudflare R2 using signed uploads.
Production-safe. Stateless. Audit-ready.

1№ИЈРЃБ Install Required Dependencies

Run this in Replit Shell:

npm install @aws-sdk/client-s3 @aws-sdk/s3-request-presigner

2№ИЈРЃБ Add Production Environment Variables (Replit Рєњ Secrets)

DO NOT hardcode these. Add as Secrets only.

R2_ACCOUNT_ID=xxxxxxxxxxxxxxxx
R2_ACCESS_KEY_ID=xxxxxxxxxxxxxxxx
R2_SECRET_ACCESS_KEY=xxxxxxxxxxxxxxxx
R2_BUCKET=alga-prod-assets
R2_PUBLIC_BASE_URL=https://cdn.alga.et

3№ИЈРЃБ Create R2 Client (NEW FILE)

­ЪЊё Create: src/lib/r2.ts

import { S3Client } from "@aws-sdk/client-s3";

export const r2 = new S3Client({
  region: "auto",
  endpoint: `https://${process.env.R2_ACCOUNT_ID}.r2.cloudflarestorage.com`,
  credentials: {
    accessKeyId: process.env.R2_ACCESS_KEY_ID!,
    secretAccessKey: process.env.R2_SECRET_ACCESS_KEY!,
  },
});

4№ИЈРЃБ Create Signed Upload Service (NEW FILE)

­ЪЊё Create: src/services/imageUpload.service.ts

import { PutObjectCommand } from "@aws-sdk/client-s3";
import { getSignedUrl } from "@aws-sdk/s3-request-presigner";
import { r2 } from "../lib/r2";

export async function generateImageUploadUrl(
  propertyId: string,
  filename: string,
  contentType: string
) {
  const key = `properties/${propertyId}/${filename}`;

  const command = new PutObjectCommand({
    Bucket: process.env.R2_BUCKET!,
    Key: key,
    ContentType: contentType,
  });

  const uploadUrl = await getSignedUrl(r2, command, { expiresIn: 300 });

  return {
    uploadUrl,
    publicUrl: `${process.env.R2_PUBLIC_BASE_URL}/${key}`,
  };
}

5№ИЈРЃБ Add API Endpoint (Backend)

­ЪЊё Modify: src/routes/upload.routes.ts (or equivalent)

import express from "express";
import { generateImageUploadUrl } from "../services/imageUpload.service";

const router = express.Router();

router.post("/upload-url", async (req, res) => {
  const { propertyId, filename, contentType } = req.body;

  if (!propertyId || !filename || !contentType) {
    return res.status(400).json({ error: "Missing required fields" });
  }

  const result = await generateImageUploadUrl(
    propertyId,
    filename,
    contentType
  );

  res.json(result);
});

export default router;


­ЪЊї Ensure route is registered in app entry file.

6№ИЈРЃБ Frontend Upload Logic (MANDATORY CHANGE)

Frontend must:

Request /upload-url

Upload file directly to R2

Save returned publicUrl to database

const res = await fetch("/api/upload-url", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    propertyId,
    filename: file.name,
    contentType: file.type,
  }),
});

const { uploadUrl, publicUrl } = await res.json();

await fetch(uploadUrl, {
  method: "PUT",
  headers: { "Content-Type": file.type },
  body: file,
});

// Save publicUrl to DB

7№ИЈРЃБ DELETE OLD LOCAL STORAGE (NON-NEGOTIABLE)

Agent must remove:

multer

uploads/ folders

Any fs.writeFile, diskStorage, or local paths

РЮї No local persistence allowed in production.

8№ИЈРЃБ Verification Checklist (Agent Must Confirm)

 No files written to local disk

 Images persist after server restart

 URLs load from cdn.alga.et

 DB stores URLs only

 Replit Object Storage unused in prod

CEO FINAL DIRECTIVE (COPY THIS TO AGENT)

РђюImplement Cloudflare R2 using signed uploads.
Replit storage is dev-only.
No local filesystem writes.
URLs saved to DB, files live in R2.
This is production and audit-final.РђЮ

If you want next, I can:

Produce a single diff-style patch

Add image validation & size limits

Create auto-cleanup on property delete

Write a 1-page INSA storage compliance note

Say the word Рђћ weРђЎll lock this in properly.

seed powder use of avocado seed in amharic language

рІеріарЅ«ріФрІХ рІўрѕГ рІ▒рЅёрЅх (Avocado Seed Powder) ріарїарЅЃрЅђрѕЮ

рІеріарЅ«ріФрІХ рІўрѕГ рІ▒рЅёрЅх рЅарЅ░рЇѕрїЦрѕ»рІі рѕўріЋрїѕрІх рІерѕџрІўрїІрїЁ рѕ▓рѕєріЋ рЅарЅБрѕЁрѕІрІі рѕЋріГрѕЮріЊріЊ рЅарѕЮрїЇрЅЦ рЅ░рїерѕЏрѕф рѕўрѕЇріЕ рІГрїарЅђрѕЏрѕЇрЇб ріерЅ│рЅй рІІріЊ ріарїарЅЃрЅђрѕърЅ╣ рЅ░рІўрѕГрІЮрѕерІІрѕЇрЇд

1) рѕѕрѕўрЇЇрїерЅх ріЦріЊ рѕѕрѕєрІх

рІерѕўрЇЇрїерЅх рЅйрїЇріЮріљрЅхріЋ рѕірѕерІ│

рїЅрЅарЅх рѕўріЋрЇѕрѕ│рѕйріљрЅхріЋ рѕірІФрѕ╗рѕйрѕЇ

рІерѕєрІх рѕўрІЇрїФ/рѕўрїЇрЅбрІФ ріЦрЅЦрїарЅхріЋ рѕірЅђріЋрѕх

2) рѕѕріЦрЅЦрїарЅх ріЦріЊ рідріГрѕ▓рІ│рЅ▓рЅГ рїЅрІ│рЅх

ріерЇЇрЅ░ріЏ ріаріЋрЅ▓рідріГрѕ▓рІ│ріЋрЅх рІГрІЪрѕЇ

рІерѕ░рІЇріљрЅх ріЦрЅЦрїарЅхріЋ рѕірЅђріЋрѕх

3) рѕѕрі«рѕїрѕхрЅхрѕ«рѕЇ ріЦріЊ рѕЇрЅЦ

рѕўрїЦрЇј рі«рѕїрѕхрЅхрѕ«рѕЇ (LDL) рѕірЅђріЋрѕх

рІерѕЇрЅЦ рїцріЊріЋ рѕірІ░рїЇрЇЇ

4) рѕѕрѕхрі│рѕГ рЅЂрїЦрїЦрѕГ

рІерІ░рѕЮ рѕхрі│рѕГ рѕўрїаріЋріЋ рѕѕрѕўрЅєрїБрїарѕГ рѕірѕерІ│

5) рѕѕрЅєрІ│ ріЦріЊ рЇђрїЅрѕГ (рІЇрїГ ріарїарЅЃрЅђрѕЮ)

рЅарѕЏрѕхріГ рѕўрѕЇріЕ рЅєрІ│ріЋ рѕірїаріљріГрѕГ

рІерЇђрїЅрѕГ рѕЦрѕ«рЅйріЋ рѕірІФрЅарѕерЅ│

ріЦріЋрІ┤рЅх рѕўрІўрїІрїђрЅх ріЦріЊ рѕўрїарЅђрѕЮ

рІеріарЅ«ріФрІХ рІўрѕГріЋ ріарїЦрЅЦрЅђрІЇ рІФрїарЅА

рЅарЇђрѕљрІГ рІѕрІГрѕЮ рЅарІЮрЅЁрЅ░ріЏ рѕЎрЅђрЅх рІФрІхрѕГрЅЂ

рІФрЇЇрїЕ ріЦріЊ рІ▒рЅёрЅх рІФрІхрѕГрїЅ

рЅарѕ╗рІГрЇБ рЅарѕхрѕЎрІЮ рІѕрІГрѕЮ рЅарѕЏрѕГ рїІрѕГ рЅарЅхріЋрѕй рѕўрїаріЋ рІГрїарЅђрѕЎ

рѕўрїаріЋ (ріарѕхрЇѕрѕІрїі):

рЅарЅђріЋ ┬╝ рѕЏріЋріфрІФ рІ▒рЅёрЅх рЅЦрЅ╗ рїђрѕЮрѕЕ

Рџа№ИЈ рѕЏрѕхрїаріЋрЅђрЅѓрІФ

рЅЦрІЎ рѕўрїаріЋ рѕўрїарЅђрѕЮ ріарІГрѕўріерѕГрѕЮ

ріЦрѕГрїЅрІЮ рѕ┤рЅХрЅйрЇБ рІерїАрЅх ріЦріЊрЅХрЅйрЇБ рІерѕєрІх рЅйрїЇріЮріљрЅх рІФрѕІрЅИрІЇ рѕ░рІјрЅй ріерѕўрїарЅђрѕЮ рЅарЇірЅх рѕљріфрѕЮ рІФрѕЏріГрѕЕ

рІГрѕЁ рѕўрѕерїЃ рЅБрѕЁрѕІрІі ріЦріЊ ріарїарЅЃрѕІрІГ рѕўрѕерїЃ рЅЦрЅ╗ ріљрІЇрЇц рѕЋріГрѕЮріЊ ріарІГрЅ░ріФрѕЮ

ріерЇѕрѕѕрїЅ ріЦріЋрІ▓рѕЂрѕЮ ріарїГрѕГ ріЦрЅЃ рѕІрЅЦрѕЇ (packaging text) рІѕрІГрѕЮ рІерѕЏрѕЁрЅарѕФрІі рѕџрІ▓рІФ ріФрЇЋрѕйріЋ рЅаріарѕЏрѕГріЏ рѕЏрІўрїІрїђрЅх ріЦрЅйрѕІрѕѕрѕЂрЇб

 use of avocado  in amharic language

рІеріарЅ«ріФрІХ ріарїарЅЃрЅђрѕЮ (Uses of Avocado) РђЊ рЅаріарѕЏрѕГріЏ

ріарЅ«ріФрІХ рЅаріЋрїЦрѕе рѕЮрїЇрЅЦ рІерЅарѕѕрЇђрїѕ рЇЇрѕг рѕ▓рѕєріЋ рѕѕрїцріЊрЇБ рѕѕрІЇрЅарЅх ріЦріЊ рѕѕрѕЮрїЇрЅЦ ріарїарЅЃрЅђрѕЮ рЅарѕГріФрЅ│ рїЦрЅЁрѕърЅй ріарѕЅрЅхрЇб

1) рѕѕрїцріЊ

рїЦрѕЕ рЅЁрЅБрЅх (Healthy fats) рІГрІЪрѕЇрЇБ рІерѕЇрЅЦ рїцріЊріЋ рІГрІ░рїЇрЇІрѕЇ

рЇІрІГрЅарѕГ рЅарѕўрЅЦрІЏрЅх рѕхрѕѕрѕџрІФріФрЅхрЅх рѕўрЇЇрїерЅхріЋ рІФрѕ╗рѕйрѕІрѕЇ

рЅФрІГрЅ│рѕџріЋ A, E, K, B6 ріЦріЊ рЇќрЅ│рѕхрІерѕЮ рІГрІЪрѕЇ

рІерѕўрїЦрЇј рі«рѕїрѕхрЅхрѕ«рѕЇ (LDL) рѕўрїаріЋріЋ рѕірЅђріЋрѕх рІГрЅйрѕІрѕЇ

рІерІ░рѕЮ рѕхрі│рѕГ рѕўрЅєрїБрїарѕГріЋ рѕірѕерІ│

2) рѕѕрЅєрІ│

рЅєрІ│ріЋ рІФрѕГрїЦрЅБрѕЇ ріЦріЊ рІФрѕѕрѕхрѕЇрѕ│

рЅарЇірЅх рѕЏрѕхріГ рѕўрѕЇріЕ рѕўрїарЅђрѕЮ рІГрЅ╗рѕІрѕЇ

рІерЅєрІ│ рІхрѕГрЅђрЅхріЋ рІГрЅђріЋрѕ│рѕЇ

3) рѕѕрЇђрїЅрѕГ

рІерЇђрїЅрѕГ рѕЦрѕ«рЅйріЋ рІФрЅарѕерЅ│

рІхрѕГрЅђрЅхріЋ ріЦріЊ рѕўрЅєрѕФрѕерїЦріЋ рІГрЅђріЋрѕ│рѕЇ

рЅарІўрІГрЅх рІѕрІГрѕЮ рѕЏрѕхріГ рѕўрѕЇріЕ рІГрїарЅђрѕЏрѕЇ

4) рѕѕрѕЮрїЇрЅЦ

рЅарѕ│рѕІрІхрЇБ рЅарѕ│ріЋрІхрІірЅйрЇБ рЅарѕхрѕЎрІЮ рѕўрїарЅђрѕЮ рІГрЅ╗рѕІрѕЇ

ріЦріЋрІ░ РђюрїЅрІІріФрѕърѕїРђЮ рѕЮрїЇрЅЦ рѕірІўрїІрїЁ рІГрЅйрѕІрѕЇ

ріеріЦріЋрїђрѕФрЇБ ріерІ│рЅд рїІрѕГ рЅђрѕІрѕЇ рѕЮрїЇрЅЦ ріљрІЇ

5) рѕѕрѕЋрЇЃріЊрЅх

рЅарѕџрїѕрЅБ ріерЅ░рЇѕрїе рЅаріІрѕІ ріЦріЋрІ░ рѕЮрїЇрЅЦ рЅ░рїерѕЏрѕф (puree) рѕірѕ░рїЦ рІГрЅйрѕІрѕЇ

ріЃрІГрѕЇ рІерѕџрѕ░рїЦ ріЦріЊ рЅђрѕІрѕЇ рІерѕџрЇѕрїГ рѕЮрїЇрЅЦ ріљрІЇ

Рџа№ИЈ рѕЏрѕхрїаріЋрЅђрЅѓрІФ

рЅарѕўрїаріЋ рѕўрїарЅђрѕЮ рІГрѕўріерѕФрѕЇ (рЅЦрІЎ рЅЁрЅБрЅх рІГрІЪрѕЇ)

рѕѕріаріЋрІ│ріЋрІх рѕ░рІјрЅй рІерѕєрІх рѕЏрЅЁрѕѕрѕй рѕірІФрѕўрїБ рІГрЅйрѕІрѕЇ

ріерЇѕрѕѕрїЅрЇБ

ріарїГрѕГ рІерѕЏрѕЁрЅарѕФрІі рѕџрІ▓рІФ ріФрЇЋрѕйріЋ

рІерїѕрЅарІФ рѕІрЅЦрѕЇ (packaging text)

рІѕрІГрѕЮ рѕѕрѕЋрЇЃріЊрЅх рІерѕџрѕўрЅй ріарїГрѕГ рѕўрїЇрѕѕрїФ

рЅаріарѕЏрѕГріЏ ріЦрІўрїІрїЃрѕѕрѕЂрЇб